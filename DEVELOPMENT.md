# Env Marker 開発ガイド

このドキュメントでは、Env Marker Chrome拡張機能の開発方法について説明します。

## 開発環境のセットアップ (wxt)

このプロジェクトでは、[wxt](https://wxt.dev/) を使用して、ファイルの変更を監視し、自動的にビルドする開発環境を構築しています。これにより、コードの変更が即座に拡張機能に反映され、効率的に開発を進めることができます。

### 1. 依存関係のインストール

プロジェクトのルートディレクトリで、以下のコマンドを実行して必要なパッケージをインストールします。

```bash
pnpm install
```

### 2. 開発サーバーの起動 (Watch Mode)

以下のコマンドを実行すると、wxtがファイルの変更を監視し、変更があるたびに`.output/chrome-mv3`フォルダに自動的に再ビルドします。

```bash
pnpm dev
```

このコマンドを実行すると、`.output` フォルダが生成され、その中にビルドされた拡張機能のファイルが格納されます。このプロセスは、ターミナルを閉じるまで継続します。

### 3. Chromeへの拡張機能の読み込み

初回のみ、Chromeに開発中の拡張機能を読み込む必要があります。

1.  Chromeで `chrome://extensions` を開きます。
2.  右上の「デベロッパーモード」をオンにします。
3.  もし以前に「Env Marker」を読み込んでいた場合は、一度削除してください。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、プロジェクトルートに生成された **`.output/chrome-mv3` フォルダ**を選択します。

### 4. 開発フロー

`pnpm dev` を実行したままコードを編集・保存すると、wxtが変更を検知し、`.output/chrome-mv3` フォルダ内のファイルが自動的に更新されます。

変更をChromeに反映させるには、`chrome://extensions` ページでEnv Marker拡張機能の**リロードボタン（円形の矢印）を押してください。**

### ビルド

拡張機能を本番用にビルドするには、以下のコマンドを実行します。

```bash
pnpm build
```

これにより、`.output/chrome-mv3.zip` にパッケージ化された拡張機能ファイルが生成されます。

### トラブルシューティング

#### 変更がChromeに反映されない、またはオプション画面が表示されない場合

wxtを導入した後は、Chromeに読み込む拡張機能のフォルダが **`.output/chrome-mv3` フォルダ** になります。

1.  `pnpm dev` が正常に実行されていることを確認してください。
2.  Chromeの拡張機能管理画面 (`chrome://extensions`) で、既存の「Env Marker」を一度削除し、**プロジェクトルートに生成された `.output/chrome-mv3` フォルダ**を「パッケージ化されていない拡張機能を読み込む」で指定し直してください。
3.  wxtのキャッシュが原因で変更が反映されない場合は、`pnpm dev` を一度停止し、`.output` と `.wxt` ディレクトリを削除してから再度 `pnpm dev` を実行してみてください。
    **それでも反映されない場合は、Chromeブラウザ自体を一度終了し、再起動してください。**
