# Env Marker 開発ガイド

このドキュメントでは、Env Marker Chrome拡張機能の開発方法について説明します。

## 開発環境のセットアップ (Vite + Watch Mode)

このプロジェクトでは、Viteと`vite-plugin-web-extension`を使用して、ファイルの変更を監視し、自動的にビルドする開発環境を構築しています。これにより、コードの変更が即座に拡張機能に反映され、効率的に開発を進めることができます。

### 1. 依存関係のインストール

プロジェクトのルートディレクトリで、以下のコマンドを実行して必要なパッケージをインストールします。

```bash
npm install
```

### 2. 開発サーバーの起動 (Watch Mode)

以下のコマンドを実行すると、Viteがファイルの変更を監視し、変更があるたびに`dist`フォルダに自動的に再ビルドします。

```bash
npm run dev
```

このコマンドを実行すると、`dist` フォルダが生成され、その中にビルドされた拡張機能のファイルが格納されます。このプロセスは、ターミナルを閉じるまで継続します。

### 3. Chromeへの拡張機能の読み込み

初回のみ、Chromeに開発中の拡張機能を読み込む必要があります。

1.  Chromeで `chrome://extensions` を開きます。
2.  右上の「デベロッパーモード」をオンにします。
3.  もし以前に「Env Marker」を読み込んでいた場合は、一度削除してください。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、プロジェクトルートに生成された **`dist` フォルダ**を選択します。

### 4. 開発フロー

`npm run dev` を実行したままコードを編集・保存すると、Viteが変更を検知し、`dist` フォルダ内のファイルが自動的に更新されます。

変更をChromeに反映させるには、`chrome://extensions` ページでEnv Marker拡張機能の**リロードボタン（円形の矢印）を押してください。**

### トラブルシューティング

#### `npm run dev` 実行時に `ECONNRESET` エラーが発生する場合

このエラーは、Viteが開発サーバー起動時にブラウザを自動で開こうとして、CLI環境ではそれができずに発生する問題でした。現在はWatch Modeに切り替えることで回避しています。

*   `options.html` の `<script src="options.js">` タグに `type="module"` 属性が追加されていることを確認してください。
*   `vite.config.js` に `server: { open: false }` と `webExtension({ ..., disableAutoLaunch: true })` が設定されていることを確認してください。これらの設定は、開発サーバーモードでの問題を回避するために導入されましたが、Watch Modeでも残しておくことで、将来的なモード変更時の互換性を保ちます。

#### 変更がChromeに反映されない、またはオプション画面が表示されない場合

Viteを導入した後は、Chromeに読み込む拡張機能のフォルダが **`dist` フォルダ** になります。

1.  `npm run dev` が正常に実行されていることを確認してください。
2.  Chromeの拡張機能管理画面 (`chrome://extensions`) で、既存の「Env Marker」を一度削除し、**プロジェクトルートに生成された `dist` フォルダ**を「パッケージ化されていない拡張機能を読み込む」で指定し直してください。
3.  Viteのキャッシュが原因で変更が反映されない場合は、以下のコマンドでキャッシュをクリアして再ビルドを強制できます。

    ```bash
    npm run dev -- --force
    ```

    このコマンドを実行後、再度Chromeの拡張機能をリロード（`chrome://extensions` のリロードボタン）してください。
    **それでも反映されない場合は、Chromeブラウザ自体を一度終了し、再起動してください。**

## gemini

https://github.com/google-github-actions/run-gemini-cli/blob/v0.1.14/README.md#quick-start
