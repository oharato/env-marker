# Env Marker

指定したURLやIPアドレスのサイトを開いたときに、視覚的に識別しやすくするためのChrome拡張。

使い方:
1. Chrome拡張のデベロッパーモードでこのフォルダを読み込む（`manifest.json`があるフォルダを指定）。
2. オプション画面で監視したいURLやIPアドレスのパターンを設定し、色を選択。
3. 指定したサイトにアクセスするとページ上部に色バナーが表示され、タイトルに設定したプレフィックスが付く。

注意: Manifest V3 の制約から、タブツールバーそのものの色変更は制限があります。バナーとタイトル変更で代替しています。

## 開発環境のセットアップ (Vite + ホットリロード)

このプロジェクトでは、Viteと`vite-plugin-web-extension`を使用して、ホットリロードが可能な開発環境を構築しています。これにより、コードの変更が即座に拡張機能に反映され、効率的に開発を進めることができます。

### 1. 依存関係のインストール

プロジェクトのルートディレクトリで、以下のコマンドを実行して必要なパッケージをインストールします。

```bash
npm install
```

### 2. 開発サーバーの起動

以下のコマンドを実行すると、Viteが開発サーバーを起動し、ファイルの変更を監視します。

```bash
npm run dev
```

このコマンドを実行すると、`dist` フォルダが生成され、その中にビルドされた拡張機能のファイルが格納されます。

### 3. Chromeへの拡張機能の読み込み

初回のみ、Chromeに開発中の拡張機能を読み込む必要があります。

1.  Chromeで `chrome://extensions` を開きます。
2.  右上の「デベロッパーモード」をオンにします。
3.  もし以前に「Env Marker」を読み込んでいた場合は、一度削除してください。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、プロジェクトルートに生成された **`dist` フォルダ**を選択します。

### 4. ホットリロードでの開発

`npm run dev` を実行したままコードを編集・保存すると、Viteが変更を検知し、自動的に拡張機能がリロードされます。これにより、手動でのリロード作業なしに、変更を即座に確認できます。

### トラブルシューティング

#### `npm run dev` 実行時に `ECONNRESET` エラーが発生する場合

これは、Viteが開発サーバー起動時にブラウザを自動で開こうとして、CLI環境ではそれができずに発生するエラーです。以下の設定で回避しています。

*   `options.html` の `<script src="options.js">` タグに `type="module"` 属性を追加。
*   `vite.config.js` に `server: { open: false }` と `webExtension({ ..., disableAutoLaunch: true })` を設定。

これらの設定が正しく適用されているか確認してください。

#### 変更がChromeに反映されない、またはオプション画面が表示されない場合

Viteを導入した後は、Chromeに読み込む拡張機能のフォルダが **`dist` フォルダ** になります。

1.  `npm run dev` が正常に実行されていることを確認してください。
2.  Chromeの拡張機能管理画面 (`chrome://extensions`) で、既存の「Env Marker」を一度削除し、**プロジェクトルートに生成された `dist` フォルダ**を「パッケージ化されていない拡張機能を読み込む」で指定し直してください。
3.  Viteのキャッシュが原因で変更が反映されない場合は、以下のコマンドでキャッシュをクリアして再ビルドを強制できます。

    ```bash
    npm run dev -- --force
    ```

    このコマンドを実行後、再度Chromeの拡張機能をリロード（`chrome://extensions` のリロードボタン）してください。
